<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Profile Account - Free60 Wiki archive</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Free60 Wiki archive</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../%21TODO/" class="nav-link">ToDo</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#encryption" class="nav-link">Encryption</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#decrypted-file" class="nav-link">Decrypted File</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#reservedflags" class="nav-link">Reserved(flags)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cached-user-flags" class="nav-link">Cached User Flags</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#passcode" class="nav-link">Passcode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#xuid" class="nav-link">XUID</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#country" class="nav-link">Country</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#subscriptionteir" class="nav-link">SubscriptionTeir</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#language" class="nav-link">Language</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>The Account file is a HMAC-RC4 encrypted file stored in profiles to hold
things such as the profiles gamertag, PUID (Passport User ID), online
key and more.</p>
<h1 id="encryption">Encryption</h1>
<p>The file is encrypted with a custom form of HMAC-RC4, which is handled
by the XeKeysUnobfuscate function. The key differs between retail and
development consoles and is stored in key index 0x19.</p>
<ul>
<li>Retail
    key</li>
</ul>
<!-- end list -->

<pre><code>0xE1 0xBC 0x15 0x9C 0x73 0xB1 0xEA 0xE9 0xAB 0x31 0x70 0xF3 0xAD 0x47 0xEB 0xF3
</code></pre>
<ul>
<li>Devkit
    key</li>
</ul>
<!-- end list -->

<pre><code>0xDA 0xB6 0x9A 0xD9 0x8E 0x28 0x76 0x4F 0x97 0x7E 0xE2 0x48 0x7E 0x4F 0x3F 0x68
</code></pre>
<p>To decrypt the file:</p>
<ul>
<li>Copy the first 16 bytes of the file to a buffer. This is the
    HMAC-SHA1 hash of the file which is made using one of the keys
    above.</li>
<li>Use HMAC-SHA1 on that buffer with a key from above to create the RC4
    key, which is 0x10 bytes.</li>
<li>Decrypt 8 bytes after the hash of the file (at offset 0x10) using
    RC4. This is the confounder.</li>
<li>Decrypt 380 bytes after the confounder using RC4. This is the
    decrypted account data.</li>
<li>Make a hash of the confounder and decrypted data using HMAC-SHA1 and
    a key above and compare it to the first 16 bytes of the file, if it
    doesn't match then the decryption failed.</li>
</ul>
<p>To encrypt the file:</p>
<ul>
<li>Copy the decrypted data to offset 0x18</li>
<li>Create a random 8 byte confounder and copy this to offset 0x10.</li>
<li>Make a hash of the confounder and decrypted data using HMAC-SHA1 and
    a key above, resize it to 16 bytes and then copy that to the
    beginning of the file.</li>
<li>Use HMAC-SHA1 on that hash with a key from above to create the RC4
    key, which is 0x10 bytes.</li>
<li>Encrypt 388 bytes from position 0x10 using RC4.</li>
</ul>
<h1 id="decrypted-file">Decrypted File</h1>
<table>
<thead>
<tr class="header">
<th><p>Offset</p></th>
<th><p>Length</p></th>
<th><p>Type</p></th>
<th><p>Information</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>0</p></td>
<td><p>4</p></td>
<td><p>UInt32</p></td>
<td><p>Reserved(Flags)<br />
</p></td>
</tr>
<tr class="even">
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>UInt32</p></td>
<td><p>LiveFlags</p></td>
</tr>
<tr class="odd">
<td><p>8</p></td>
<td><p>16 chars/32 bytes</p></td>
<td><p>Unicode</p></td>
<td><p>Gamertag</p></td>
</tr>
<tr class="even">
<td><p>40</p></td>
<td><p>8</p></td>
<td><p>ulong</p></td>
<td><p>XUID</p></td>
</tr>
<tr class="odd">
<td><p>48</p></td>
<td><p>4</p></td>
<td><p>UInt32</p></td>
<td><p>Cached User Flags</p></td>
</tr>
<tr class="even">
<td><p>52</p></td>
<td><p>4</p></td>
<td><p>ASCII string</p></td>
<td><p>Xbox Live Service Provider</p></td>
</tr>
<tr class="odd">
<td><p>56</p></td>
<td><p>4</p></td>
<td><p>PasscodeKeys[4]</p></td>
<td><p>Passcode</p></td>
</tr>
<tr class="even">
<td><p>60</p></td>
<td><p>20</p></td>
<td><p>ASCII string</p></td>
<td><p>Online Domain</p></td>
</tr>
<tr class="odd">
<td><p>80</p></td>
<td><p>24</p></td>
<td><p>ASCII string</p></td>
<td><p>Online Kerberos Realm</p></td>
</tr>
<tr class="even">
<td><p>104</p></td>
<td><p>16</p></td>
<td><p>Bytes</p></td>
<td><p>Online Key</p></td>
</tr>
<tr class="odd">
<td><p>120</p></td>
<td><p>114</p></td>
<td><p>ASCII string</p></td>
<td><p>User Passport Membername</p></td>
</tr>
<tr class="even">
<td><p>234</p></td>
<td><p>32</p></td>
<td><p>ASCII string</p></td>
<td><p>User Passport Password</p></td>
</tr>
<tr class="odd">
<td><p>266</p></td>
<td><p>114</p></td>
<td><p>ASCII string</p></td>
<td><p>Owner Passport Membername</p></td>
</tr>
</tbody>
</table>

<ul>
<li>Note Last 3 not used anymore(if ever).</li>
</ul>
<h2 id="reservedflags">Reserved(flags)</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Passcode Enabled</td>
<td>0x10000000</td>
</tr>
<tr>
<td>LIVE Enabled</td>
<td>0x20000000</td>
</tr>
<tr>
<td>Recovering</td>
<td>0x40000000</td>
</tr>
</tbody>
</table>
<p>The flag at bit0 seems to be always set, not sure what it means though.</p>
<h2 id="cached-user-flags">Cached User Flags</h2>
<table>
<thead>
<tr>
<th>Bits Used Indices</th>
<th>Field Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Payment Instrument Credit Card</td>
</tr>
<tr>
<td>8-15</td>
<td>Country</td>
</tr>
<tr>
<td>16-19</td>
<td>Subscription Teir</td>
</tr>
<tr>
<td>24</td>
<td>Parental Controls Enabled</td>
</tr>
<tr>
<td>25-29</td>
<td>Language</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The other bits are used, I'm just not sure what they all represent.</p>
<h2 id="passcode">Passcode</h2>
<p>The passcode is made up of these bytes:</p>
<table>
<thead>
<tr>
<th>Byte</th>
<th>Button</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Null</td>
</tr>
<tr>
<td>1</td>
<td>DPad Up</td>
</tr>
<tr>
<td>2</td>
<td>DPad Down</td>
</tr>
<tr>
<td>3</td>
<td>DPad Left</td>
</tr>
<tr>
<td>4</td>
<td>DPad Right</td>
</tr>
<tr>
<td>5</td>
<td>X</td>
</tr>
<tr>
<td>6</td>
<td>Y</td>
</tr>
<tr>
<td>7</td>
<td>A</td>
</tr>
<tr>
<td>8</td>
<td>B</td>
</tr>
<tr>
<td>9</td>
<td>Left Trigger</td>
</tr>
<tr>
<td>10</td>
<td>Right Trigger</td>
</tr>
<tr>
<td>11</td>
<td>Left Bumper</td>
</tr>
<tr>
<td>12</td>
<td>Right Bumper</td>
</tr>
</tbody>
</table>
<ul>
<li>Note A and B are not valid for
passwords.</li>
</ul>
<h2 id="xuid">XUID</h2>
<p><code>public class XUID</code>
<code>{</code>
<code>public System.UInt64 Value;</code>
<code>public XUID(System.UInt64 _Value)</code>
<code>{</code>
<code>Value = _Value;</code>
<code>}</code>
<code>public System.Boolean IsOfflineXuid</code>
<code>{</code>
<code>get</code>
<code>{</code>
<code>return (Value &amp; 17293822569102704640L) == 16140901064495857664L;</code>
<code>}</code>
<code>}</code>
<code>public System.Boolean IsOnline</code>
<code>{</code>
<code>get</code>
<code>{</code>
<code>return (Value &amp; 18446462598732840960L) == 2533274790395904L;</code>
<code>}</code>
<code>}</code>
<code>public System.Boolean IsTeam//Guess this is todo with devs</code>
<code>{</code>
<code>get</code>
<code>{</code>
<code>return (Value &amp; 18374686479671624000L) == 18302628885633696000L;</code>
<code>}</code>
<code>}</code>
<code>public System.Boolean IsValidXuid</code>
<code>{</code>
<code>get</code>
<code>{</code>
<code>return IsOfflineXuid != IsOnlineXuid;</code>
<code>}</code>
<code>}</code>
<code>}</code></p>
<h2 id="country">Country</h2>
<p><code>public enum XboxLiveCountry</code>
<code>{</code>
<code>Albania = 2,</code>
<code>Algeria = 0x1b,</code>
<code>Argentina = 4,</code>
<code>Armenia = 3,</code>
<code>Australia = 6,</code>
<code>Austria = 5,</code>
<code>Azerbaijan = 7,</code>
<code>Bahrain = 10,</code>
<code>Belarus = 14,</code>
<code>Belgium = 8,</code>
<code>Belize = 15,</code>
<code>Bolivia = 12,</code>
<code>Brazil = 13,</code>
<code>BruneiDarussalam = 11,</code>
<code>Bulgaria = 9,</code>
<code>Canada = 0x10,</code>
<code>Chile = 0x13,</code>
<code>China = 20,</code>
<code>Colombia = 0x15,</code>
<code>CostaRica = 0x16,</code>
<code>Croatia = 0x29,</code>
<code>CzechRepublic = 0x17,</code>
<code>Denmark = 0x19,</code>
<code>DominicanRepublic = 0x1a,</code>
<code>Ecuador = 0x1c,</code>
<code>Egypt = 30,</code>
<code>ElSalvador = 0x5f,</code>
<code>Estonia = 0x1d,</code>
<code>FaroeIslands = 0x21,</code>
<code>Finland = 0x20,</code>
<code>France = 0x22,</code>
<code>Georgia = 0x24,</code>
<code>Germany = 0x18,</code>
<code>Greece = 0x25,</code>
<code>Guatemala = 0x26,</code>
<code>Honduras = 40,</code>
<code>HongKong = 0x27,</code>
<code>Hungary = 0x2a,</code>
<code>Iceland = 0x31,</code>
<code>India = 0x2e,</code>
<code>Indonesia = 0x2b,</code>
<code>Iran = 0x30,</code>
<code>Iraq = 0x2f,</code>
<code>Ireland = 0x2c,</code>
<code>Israel = 0x2d,</code>
<code>Italy = 50,</code>
<code>Jamaica = 0x33,</code>
<code>Japan = 0x35,</code>
<code>Jordan = 0x34,</code>
<code>Kazakhstan = 0x3a,</code>
<code>Kenya = 0x36,</code>
<code>Korea = 0x38,</code>
<code>Kuwait = 0x39,</code>
<code>Kyrgyzstan = 0x37,</code>
<code>Latvia = 0x3f,</code>
<code>Lebanon = 0x3b,</code>
<code>LibyanArabJamahiriya = 0x40,</code>
<code>Liechtenstein = 60,</code>
<code>Lithuania = 0x3d,</code>
<code>Luxembourg = 0x3e,</code>
<code>Macao = 0x45,</code>
<code>Macedonia = 0x43,</code>
<code>Malaysia = 0x48,</code>
<code>Maldives = 70,</code>
<code>Mexico = 0x47,</code>
<code>Monaco = 0x42,</code>
<code>Mongolia = 0x44,</code>
<code>Morocco = 0x41,</code>
<code>Netherlands = 0x4a,</code>
<code>NewZealand = 0x4c,</code>
<code>Nicaragua = 0x49,</code>
<code>Norway = 0x4b,</code>
<code>Oman = 0x4d,</code>
<code>Pakistan = 0x51,</code>
<code>Panama = 0x4e,</code>
<code>Paraguay = 0x55,</code>
<code>Peru = 0x4f,</code>
<code>Philippines = 80,</code>
<code>Poland = 0x52,</code>
<code>Portugal = 0x54,</code>
<code>PuertoRico = 0x53,</code>
<code>Qatar = 0x56,</code>
<code>Romania = 0x57,</code>
<code>RussianFederation = 0x58,</code>
<code>SaudiArabia = 0x59,</code>
<code>Singapore = 0x5b,</code>
<code>Slovakia = 0x5d,</code>
<code>Slovenia = 0x5c,</code>
<code>SouthAfrica = 0x6d,</code>
<code>Spain = 0x1f,</code>
<code>Sweden = 90,</code>
<code>Switzerland = 0x12,</code>
<code>SyrianArabRepublic = 0x60,</code>
<code>Taiwan = 0x65,</code>
<code>Thailand = 0x61,</code>
<code>TrinidadAndTobago = 100,</code>
<code>Tunisia = 0x62,</code>
<code>Turkey = 0x63,</code>
<code>Ukraine = 0x66,</code>
<code>UnitedArabEmirates = 1,</code>
<code>UnitedKingdom = 0x23,</code>
<code>UnitedStates = 0x67,</code>
<code>Unknown = 0,</code>
<code>Uruguay = 0x68,</code>
<code>Uzbekistan = 0x69,</code>
<code>Venezuela = 0x6a,</code>
<code>Vietnam = 0x6b,</code>
<code>Yemen = 0x6c,</code>
<code>Zimbabwe = 110</code>
<code>}</code></p>
<h2 id="subscriptionteir">SubscriptionTeir</h2>
<p><code>enum SubscriptionTeir</code>
<code>{</code>
<code>NoSubcription,</code>
<code>Silver = 3,</code>
<code>Gold = 6,</code>
<code>FamilyGold = 9</code>
<code>};</code></p>
<h2 id="language">Language</h2>
<p><code>enum ConsoleLanguage</code>
<code>{</code>
<code>None,</code>
<code>English,</code>
<code>Japanese,</code>
<code>German,</code>
<code>French,</code>
<code>Spanish,</code>
<code>Italian,</code>
<code>Korean,</code>
<code>TChinese,</code>
<code>Portuguese,</code>
<code>SChinese,</code>
<code>Polish,</code>
<code>Russian</code>
<code>};</code></p>
<p><a href="Category_Xbox360_System_Software">Category:Xbox360 System Software</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
