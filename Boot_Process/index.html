<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Boot process - Free60 Wiki archive</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Free60 Wiki archive</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../%21TODO/" class="nav-link">ToDo</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#boot-process" class="nav-link">Boot process</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#retail" class="nav-link">Retail</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#devkit" class="nav-link">Devkit</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#core-os-executables" class="nav-link">Core OS Executables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="boot-process">Boot process</h1>
<p>This page details the boot process used in the Xbox 360. The process is
slightly different between Devkit/Retail and certain boxes which have a
secondary CB loader (trinity/some jaspers)</p>
<h2 id="retail">Retail</h2>
<p>In Summary:</p>
<ul>
<li>Slim: 1BL -> CB_A -> CB_B -> CD -> CF -> CD -> HV -> Kernel -> Dashboard</li>
<li>Phat (older): 1BL -> CB -> CD -> CF -> CD -> HV -> Kernel -> Dashboard</li>
<li>Phat (newer): 1BL -> CB_A -> CB_B -> CD -> CF -> CD -> HV -> Kernel -> Dashboard</li>
</ul>
<h3 id="1bl-inside-cpu">1BL (Inside CPU)</h3>
<p>Loads and decrypts CB(_A) into ram, it computes a RotSumSha1 of CB(_A)
and uses it to verify its RSA signature. If the signature is valid, 1BL
jumps to CB(_A).</p>
<p>You can find reversed pseudocode of the 1bl here: <a href="../1bl_Code">1BL Code</a></p>
<h3 id="cb">CB</h3>
<p><strong>SLIMS ONLY</strong>: CB_A loads and decrypts CB_B into ram, it computes a
RotSumSha1 of CB_B and checks it against the known hash. If it matches
CB_A jumps to CB_B.</p>
<p>CB(_B) starts up a virtual machine, which does:</p>
<pre><code>- initializes the PCI Bridge
- disables the GPU PCIE JTAG test port
- initializes the serial port
- talks to the SMC to clear the "handshake" bit
- initializes memory
- generates RROD if memory init fails
</code></pre>
<p>CB(_B) loads and decrypts CD into ram, it computes a RotSumSha1 of CD
and checks it against the known hash. If it matches CB(_B) jumps to CD.</p>
<p>Methods to dump the CB bootloaders and examples of them reversed can be
found here: <a href="../CB_Code">CB Code</a></p>
<h3 id="cd">CD</h3>
<p>Loads and decrypts CE into ram, computes a RotSumSha1 of CE. If it
matches the known hash, it decompresses the LZX compressed base
kernel.
It then checks for patch slots. If it finds one, it will load and
decrypt the corresponding CF bootloader for that patch. It then computes
a RotSumSha1 of CF and uses it to verify the CF loaders signature. If
the signature is valid, CD stays in memory but jumps to CF.</p>
<p>There can be up to 2 CF/CG pairs for patching the kernel.</p>
<h3 id="cf">CF</h3>
<p>Loads CG into memory by reading the CG data in the NAND header and then
reads the rest of the CG data from the CG blocks specified in CF header.
It then decrypts the CG in memory using the key generated from
decrypting CF. To verify it, it computes a RotSumSha1 and checks it
against the known hash. If it matches, it uses LZX delta decompress to
apply the patch to the base kernel in memory. Once its done, it jumps
back to CD and once CD has finished up, it jumps to the reset vector in
the <a href="../Hypervisor">Hypervisor</a>.</p>
<h2 id="devkit">Devkit</h2>
<p>In Summary:</p>
<ul>
<li>Phat: 1BL -> SB -> SC -> SD -> HV -> Kernel -> Dashboard</li>
</ul>
<p>The devkit bootloaders are nearly identical to their retail
counterparts; however instead of hardcoded hash checks, devkits verify
bootloaders SD and SE by signature checks.</p>
<p>The SC bootloader is the hardware initialization virtual machine run by
SB.</p>
<p>Because devkits do not update over the air, they use a pre-patched SE
(HV + kernel) bootloader) without delta patching CF/CG pairs.</p>
<h3 id="kernel">Kernel</h3>
<p>Once control is handed off to the kernel, as denoted by the
<a href="../POST">POST</a> output, the kernel does the following (on
development systems):</p>
<ul>
<li>Initialize memory manager</li>
<li>Initialize stack(s)</li>
<li>Initialize object system (?)</li>
<li>Initialize phase 1 thread (?)</li>
<li>Phase 1 initialization and processors initialization</li>
<li>Initialize keyvault</li>
<li>Initialize <a href="https://en.wikipedia.org/wiki/HAL_(software)">HAL</a> phase 1</li>
<li>Initialize SFC driver (?)</li>
<li>Initialize security (?)</li>
<li>INIT_KEY_EX_VAULT</li>
<li>Initialize settings (?)</li>
<li>Initialize power mode</li>
<li>Initialize video driver</li>
<li>Initialize audio driver</li>
<li>Initialize boot animation<ul>
<li>Loads bootanim.xex</li>
</ul>
</li>
<li>Initialize SATA driver</li>
<li>Initialize <a href="../Shadowboot">Shadowboot</a> (not on retail
  systems)</li>
<li>INIT_DUMP_SYSTEM (?) (not on retail systems)</li>
<li>INIT_SYSTEM_ROOT (?)</li>
<li>Initialize other drivers</li>
<li>Initialize <a href="../STFS">STFS</a> driver</li>
<li>Initialize XAM</li>
</ul>
<h2 id="core-os-executables">Core OS Executables</h2>
<p>After its initialization sequence, the kernel loads the following
executables (in order)</p>
<ul>
<li>xam.xex</li>
<li>xbdm.xex</li>
<li>xstudio.xex</li>
<li>ximecore.xex</li>
<li>Xam.Community.xex (from disk)</li>
<li>huduiskin.xex</li>
<li>xshell.xex (devkits) / dash.xex (retail)</li>
</ul>
<p>It then unloads the following:</p>
<ul>
<li>huduiskin.xex</li>
<li>bootanim.xex</li>
</ul>
<p>By this time the console will have booted into the dashboard</p>
<p><a href="../Category_Xbox360_System_Software">Category:Xbox360 System Software</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
