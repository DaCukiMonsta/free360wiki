<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Hypervisor - Free60 Wiki archive</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Free60 Wiki archive</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../%21TODO/" class="nav-link">ToDo</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#hypervisor" class="nav-link">Hypervisor</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#note" class="nav-link">Note</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#what-is-a-hypervisor" class="nav-link">What is a Hypervisor?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#how-it-works" class="nav-link">How It Works</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#interrupt-vectors" class="nav-link">Interrupt Vectors</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cryptography" class="nav-link">Cryptography</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#utility-functions" class="nav-link">Utility Functions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#invoking-the-hypervisor" class="nav-link">Invoking The Hypervisor</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="hypervisor">Hypervisor</h1>
<h2 id="note">Note</h2>
<p>Old notes on the Xbox 360 Hypervisor can be found here: <a href="Hypervisor_(Old_Notes)" title="wikilink">Hypervisor (Old
Notes)</a></p>
<h2 id="what-is-a-hypervisor">What is a Hypervisor?</h2>
<p>Like in the PS3, Microsoft protects the integrity of its system with a
<strong>Hypervisor</strong>. Using the virtualization technologies of today's
processors, a hypervisor can act as a small piece of code with even
higher privileges than the more complex operating system. In theory,
even potential flaws in the operating system cannot be exploited since
the hypervisor puts up additional restrictions.</p>
<p>In case of the Xbox 360, the hypervisor is responsible for encryption,
decryption and the enforcement of access restrictions on memory.</p>
<p>Thanks to the
<a href="http://www.securityfocus.com/archive/1/461489/30/0/threaded">work</a> of
an anonymous hacker, a flaw in the hypervisor has been discovered on
certain versions of the <a href="../Kernel">Xbox 360 kernel</a>, allowing
the injection of code, which has not been cryptographically signed by
Microsoft.</p>
<h2 id="how-it-works">How It Works</h2>
<p>The Hypervisor (HV) is primarily made up of a series of interrupt
vectors and system calls that are accompanied by a few cryptography
related helper sub-routines. On the 360, the main job of the HV is to
manage the security of the system and handle
encryption/crypto-signatures of files that will be run. Because of this,
the HV is only executed in Real-Mode, with the highest privileges.
Memory paging is disabled and the HV can access any memory space on the
system, including memory mapped devices, however code run from user-mode
(normal mode) cannot read or write to HV space. It is essential to
understand how the HV works to understand the lower level of software on
the xbox 360.</p>
<p>When an interrupt is generated by the CPU, it jumps to the corresponding
handler. When this occurs, the address of the instruction that generated
the interrupt is stored in SRR0 and the MSR before the interrupt
occurred is stored in SRR1 with bits 33-36 and bits 42-47 loaded with
data specific to the interrupt. For every interrupt, the CPU is sent
into Real Mode/privileged state, interrupts are the entrance to the HV.
Instruction and data relocation is disabled at this time.</p>
<p>When a return from interrupt (rfid) instruction occurs, it copies SRR1
to the MSR, synchronizes context, and jumps to the address stored in
SRR0. Unless the Interrupt modified the contents of SRR1, the program
will exit privileged state after the MSR is set.</p>
<p>All interrupts are ordered meaning while one is being handled, the CPU
will wait until it is finished before handling another. The exception to
this is the RESET and MACHINE_CHECK interrupts, these are unorded and
can take place at any time. If they occur while another interrupt is
being handled, SRR0 and SRR1 will be overwritten by the new handler and
context synchronization will be lost. During normal operation of the
Xbox 360, the RESET interrupt does not occur and the MACHINE_CHECK
interrupt is not recoverable.</p>
<h2 id="interrupt-vectors">Interrupt Vectors</h2>
<table>
<thead>
<tr>
<th>Vectors</th>
</tr>
</thead>
<tbody>
<tr>
<td>Offset</td>
</tr>
<tr>
<td>0x00000100</td>
</tr>
<tr>
<td>0x00000200</td>
</tr>
<tr>
<td>0x00000218</td>
</tr>
<tr>
<td>0x00000300</td>
</tr>
<tr>
<td>0x00000380</td>
</tr>
<tr>
<td>0x00000400</td>
</tr>
<tr>
<td>0x00000480</td>
</tr>
<tr>
<td>0x00000500</td>
</tr>
<tr>
<td>0x00000600</td>
</tr>
<tr>
<td>0x00000700</td>
</tr>
<tr>
<td>0x00000800</td>
</tr>
<tr>
<td>0x00000900</td>
</tr>
<tr>
<td>0x00000980</td>
</tr>
<tr>
<td>0x00000B9C</td>
</tr>
<tr>
<td>0x00000C00</td>
</tr>
<tr>
<td>0x00000D00</td>
</tr>
<tr>
<td>0x00000A5C</td>
</tr>
<tr>
<td>0x00000F20</td>
</tr>
<tr>
<td>0x00001600</td>
</tr>
<tr>
<td>0x00001700</td>
</tr>
<tr>
<td>0x00001800</td>
</tr>
</tbody>
</table>
<h2 id="cryptography">Cryptography</h2>
<p>Retail 17511 - These offsets are subject to change!</p>
<table>
<thead>
<tr>
<th>Cryptography Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Offset</td>
</tr>
<tr>
<td>0x00020300</td>
</tr>
<tr>
<td>0x00023500</td>
</tr>
<tr>
<td>0x000226F0</td>
</tr>
<tr>
<td>0x00022738</td>
</tr>
<tr>
<td>0x00020520</td>
</tr>
<tr>
<td>0x0000A880</td>
</tr>
<tr>
<td>0x0000AD20</td>
</tr>
<tr>
<td>0x00022DB8</td>
</tr>
<tr>
<td>0x00022BD0</td>
</tr>
<tr>
<td>0x00022CF0</td>
</tr>
<tr>
<td>0x00023170</td>
</tr>
<tr>
<td>0x00023218</td>
</tr>
<tr>
<td>0x00020578</td>
</tr>
<tr>
<td>0x00020F00</td>
</tr>
<tr>
<td>0x00021210</td>
</tr>
<tr>
<td>0x00020EC8</td>
</tr>
<tr>
<td>0x000244D8</td>
</tr>
<tr>
<td>0x00024560</td>
</tr>
<tr>
<td>0x000211F0</td>
</tr>
<tr>
<td>0x00024AF0</td>
</tr>
<tr>
<td>0x00024A40</td>
</tr>
<tr>
<td>0x00024A98</td>
</tr>
<tr>
<td>0x000247D0</td>
</tr>
<tr>
<td>0x00020910</td>
</tr>
<tr>
<td>0x00024C68</td>
</tr>
<tr>
<td>0x00023108</td>
</tr>
<tr>
<td>0x00022E98</td>
</tr>
<tr>
<td>0x00023010</td>
</tr>
<tr>
<td>0x00023060</td>
</tr>
<tr>
<td>0x000200F8</td>
</tr>
<tr>
<td>0x00023008</td>
</tr>
<tr>
<td>0x00021128</td>
</tr>
<tr>
<td>0x00020D28</td>
</tr>
<tr>
<td>0x000211A8</td>
</tr>
<tr>
<td>0x00021240</td>
</tr>
<tr>
<td>0x00021840</td>
</tr>
<tr>
<td>0x00021BC8</td>
</tr>
<tr>
<td>0x000217C0</td>
</tr>
<tr>
<td>0x00021968</td>
</tr>
<tr>
<td>0x00021710</td>
</tr>
<tr>
<td>0x00021270</td>
</tr>
<tr>
<td>0x00021C08</td>
</tr>
<tr>
<td>0x00023278</td>
</tr>
<tr>
<td>0x00023330</td>
</tr>
<tr>
<td>0x00020550</td>
</tr>
<tr>
<td>0x00020250</td>
</tr>
<tr>
<td>0x00020468</td>
</tr>
<tr>
<td>0x000203A8</td>
</tr>
<tr>
<td>0x00024420</td>
</tr>
<tr>
<td>0x00020680</td>
</tr>
<tr>
<td>0x00000E14</td>
</tr>
</tbody>
</table>
<h2 id="utility-functions">Utility Functions</h2>
<table>
<thead>
<tr>
<th>Utility Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td>Offset</td>
</tr>
<tr>
<td>0x00000384</td>
</tr>
<tr>
<td>0x00000398</td>
</tr>
<tr>
<td>0x000003C4</td>
</tr>
<tr>
<td>0x00000484</td>
</tr>
<tr>
<td>0x000004A8</td>
</tr>
<tr>
<td>0x000004D8</td>
</tr>
<tr>
<td>0x0000068C</td>
</tr>
<tr>
<td>0x000006A0</td>
</tr>
<tr>
<td>0x000006B4</td>
</tr>
<tr>
<td>0x000006CC</td>
</tr>
<tr>
<td>0x00000E14</td>
</tr>
<tr>
<td>0x00000EE4</td>
</tr>
<tr>
<td>0x00001804</td>
</tr>
<tr>
<td>0x000029E0</td>
</tr>
<tr>
<td>0x00003358</td>
</tr>
<tr>
<td>0x000033D8</td>
</tr>
<tr>
<td>0x00003620</td>
</tr>
<tr>
<td>0x00000000</td>
</tr>
</tbody>
</table>
<h1 id="invoking-the-hypervisor">Invoking The Hypervisor</h1>
<p>User-mode code can invoke the Hypervisor at any time through what is
called a system call(syscall). System calls are functions set up by the
Hypervisor that can preform various tasks on the system, for example
getting the value of a special cpu register or printing to the console's
post bus. When a system call is preformed, the cpu generates a syscall
interrupt and jumps to the appropriate handler. System calls are
described more here: <a href="../System_Calls">System Calls</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
