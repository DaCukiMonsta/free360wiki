<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>NAND Bad Blocks - Free60 Wiki archive</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Free60 Wiki archive</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../%21TODO/" class="nav-link">ToDo</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#what-is-a-block" class="nav-link">What is a BLOCK?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#what-is-a-bad-block" class="nav-link">What is a BAD BLOCK?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#how-to-determine-bad-blocks" class="nav-link">How to determine BAD BLOCKS?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#what-happens-when-a-bad-block-develops" class="nav-link">What happens when a BAD BLOCK develops?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#how-does-the-reserve-block-method-work" class="nav-link">How does the Reserve Block Method work?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#xbox-16mb-nand-block-management" class="nav-link">XBOX 16MB NAND BLOCK Management</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#xbox-256512mb-nand-block-management" class="nav-link">XBOX 256/512MB NAND BLOCK Management</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="what-is-a-block">What is a BLOCK?</h2>
<p>A block is the smallest logically addressable unit of data that a
specified device can transfer in an input/output operation. For XBOX
360s that is either 16KB or 132KB.</p>
<h2 id="what-is-a-bad-block">What is a BAD BLOCK?</h2>
<p>Bad Blocks are blocks that contain one or more invalid bits whose
reliability is not guaranteed. Bad Blocks may be present when the device
is shipped, or may develop during the lifetime of the device.</p>
<h2 id="how-to-determine-bad-blocks">How to determine BAD BLOCKS?</h2>
<p>In one block there are n Pages, all have a fixed size of 528 Bytes
(nomatter if the Block is 16K or 128K). Every Page has 16 Byte big ECC
data at its end. The block itself does not have ECC data, only the pages
have! In theory the whole block gets filled with zeros if its bad,
practicly it's not like that. So, if the first 12 Bytes of the page's
ECC data is nulled, the page is marked bad, so the whole block is
aswell. The remaining 4 Bytes of the ECC is the CRC Data. If the first
12 Bytes of ECC is 0xFF the page has no data (empty, but NOT faulty) and
if it hold anything else than 0x00 or 0xFF then the page is filled with
data.</p>
<h2 id="what-happens-when-a-bad-block-develops">What happens when a BAD BLOCK develops?</h2>
<p>There are two methods to replace the block.</p>
<ul>
<li>
<ol>
<li>Skip Block Method</li>
</ol>
</li>
<li>
<ol>
<li>Reserve Block Method</li>
</ol>
</li>
</ul>
<h2 id="how-does-the-reserve-block-method-work">How does the Reserve Block Method work?</h2>
<p>Blocks are not skipped but rather they are re-directed to a Reserved
Block Area used specifically for Bad Block replacement. The Reserved
Block Area also stores/saves the Bad Block Table that keeps track of the
re-mapped “developed Bad Blocks”. Which method does the XBOX employ?</p>
<p>Short answer both. In 16MB nands the XBOX exclusively uses the Reserve
Block Method, while in 256MB or 512MB nands it uses both. The MU area of
the nand uses the Skip Block Method, while the area where the dash and
kernel are stored uses the Reserve Block Method.</p>
<h2 id="xbox-16mb-nand-block-management">XBOX 16MB NAND BLOCK Management</h2>
<p><img alt="&lt;File:16MB.png&gt;" src="../images/16MB.png" /></p>
<p>If you noticed in the memory table above any Badblocks encountered are
consecutively moved to the Reserved BadBlock Area. The first Bad
Block(0x168) is moved to Block 0x3FF in the reserved area, the
next(0x1F6) is moved to 0X3FE, and it continues until all Bad Blocks
have been remapped.</p>
<h3 id="when-i-read-my-nand-i-have-badblocks-where-is-that-data-stored">When I read my nand I have Badblocks where is that data stored?</h3>
<p>When reading your nand any Badblocks would have already been remapped to
the reserve area. This is important to keep in mind, specifically when
you encounter Badblocks where crucial data is kept such as blocks
0x001(Key Vault), 0x3DE(First Config Block), and 0x3DF(Second Config
Block).</p>
<h3 id="how-would-i-remap-the-badblocks-in-the-diagram-with-nandpro">How would I remap the BadBlocks in the diagram with nandpro?</h3>
<p>Assuming your attempting to flash the latest release of XBReboot named
as ‘xbr.bin’. And have made a full-backup and have already injected your
Key Vault and Configuration Blocks into ‘xbr.bin’. The commands would be
as follow:</p>
<pre><code>nandpro xbr.bin: -r16 badblock168.bin 168 1
nandpro xbr.bin: -w16 badblock168.bin 3FF 1
nandpro xbr.bin: -r16 badblock1F6.bin 1F6 1
nandpro xbr.bin: -w16 badblock1F6.bin 3FE 1
nandpro xbr.bin: -r16 badblock23A.bin 23A 1
nandpro xbr.bin: -w16 badblock23A.bin 3FD 1
nandpro xbr.bin: -r16 badblock308.bin 308 1
nandpro xbr.bin: -w16 badblock308.bin 3FC 1
</code></pre>

<h3 id="if-using-xellous-to-flash-do-i-need-to-remap-badblocks">If using XeLLous to flash do I need to remap Badblocks?</h3>
<p>According to the XeLLous release notes no, it is suppose to be one of
the main features of the update. That is not to say bugs might not be
encountered. If you encounter suspicious issues, and believe it might be
related to a bad flash, then I recommend flashing manually with nandpro
or using trancy’s XBR-Flash for
Linux.</p>
<h3 id="i-have-a-badblock-between-blocks-0x000-and-0x050-and-cant-boot-into-xell-free60-version">I have a Badblock between blocks 0x000 and 0x050, and can’t boot into Xell (free60 version).</h3>
<p>First of all ensure your using the free60 version of Xell. Next you will
need to backup the location of the remapped BadBlocks like so (Remeber
your first Badblock always goes to 3FF, and each following Badblock gets
remapped as illustrated in the diagram):</p>
<p><code>nandpro lpt: -r16 backup3FF.bin 3FF 1</code></p>
<p>Assuming your first Badblock was at 0x010, you will need to remap the
free60 Xell data that was intended to be stored in that block. Like
this.</p>
<p><code>nandpro xell.bin: -r16 xell10.bin 10 1</code>
<code>nandpro lpt: -w16 xell10.bin 3FF 1</code></p>
<p>Lastly the bad block needs to erased to prevent any corruption:</p>
<p><code>nandpro lpt: -e16 10 1</code></p>
<p>(EDIT: The bad block may not need to be erased. If the CRC in the ECC
data doesn't match that of the page, the SMC will deem it a bad block
anyway and then look to the spare area for a relocated
block.)</p>
<h3 id="i-have-a-badblock-between-blocks-0x000-and-0x050-and-cant-boot-into-xell-rgh-team-xecuter-dgx-version">I have a Badblock between blocks 0x000 and 0x050, and can’t boot into Xell (RGH / Team-Xecuter DGX version).</h3>
<p>XeLL for RGH/DGX is written with +w16 ('+' to signify the recreation of
ECC data) so you cannot simply -r16 from image_00000000.ecc (or
DGX.ecc) as it's not seen by NANDPro as a valid VNAND.</p>
<p>Therefore, the following steps must be carried out:</p>
<p>Assuming your first Badblock was at 0x010,</p>
<ol>
<li>Make a copy of your original NAND</li>
</ol>
<p><code>copy nanddump.bin tempnand.bin</code></p>
<ol>
<li>Write the ECC to your NAND as per normal:</li>
</ol>
<p><code>nandpro [LPT|USB]: +w16 image_00000000.ecc.</code></p>
<p>At this point you should confirm that you get an 'error xxx writing to
xxx' message. This is perfectly normal.</p>
<ol>
<li>Write the ECC to tempnand.bin using NANDPro:</li>
</ol>
<p><code>nandpro tempnand.bin: +w16 image_00000000.ecc</code></p>
<ol>
<li>Read block 0x010 from your newly written-to VNAND:</li>
</ol>
<p><code>nandpro tempnand.bin: -r16 010.bin 10 1</code></p>
<p>5. Write the block to the same place in the spare area as the original
relocated bad block. If this is the first bad block, it should be 0x3FF
but check using 360 Flash Dump Tool, xNANDHealer, J-Runner etc to ensure
this is the case.</p>
<p><code>nandpro [LPT|USB]: -w16 010.bin 3FF</code></p>
<p>Lastly the bad block needs to erased to prevent any corruption:</p>
<p><code>nandpro lpt: -e16 10 1</code></p>
<p>(EDIT: The bad block may not need to be erased. If the CRC in the ECC
data doesn't match that of the page, the SMC will deem it a bad block
anyway and then look to the spare area for a relocated block.)</p>
<p>--<a href="User:Xb0xGuru">Xb0xGuru</a> 15:19, 24 February 2013 (UTC)</p>
<h2 id="xbox-256512mb-nand-block-management">XBOX 256/512MB NAND BLOCK Management</h2>
<p><img alt="&lt;File:256-512MB.png&gt;" src="256-512MB.png" title="File:256-512MB.png" /></p>
<h3 id="understanding-256512-mb-memory-map-and-nandpros-translation">Understanding 256/512 MB memory map, and Nandpro’s translation:</h3>
<p>The block size in 256/512 Nands is 132 KB (135168 Bytes). This is a
little different then how Nandpro references and addresses blocks. No
matter the Block size of your nand nandpro uses a block size of 16 KB
that means that for every Badblock in the 256/512 MB nandpro will report
8 consecutive errors.</p>
<p>If you noticed in the memory table above any Badblocks encountered are
consecutively moved to the Reserved BadBlock Area. The first Badblock
(0x0F8) is moved to Block 0xFF8 (16 KB) or Block 0x1FF (132 KB) in the
reserved area, any consecutive Badblocks would of been moved to blocks
0xFF0 (16 KB) or Block 0x1FE (132 KB) and so forth.</p>
<h3 id="when-i-read-my-nand-i-have-badblocks-where-is-that-data-stored_1">When I read my nand I have Badblocks where is that data stored?</h3>
<p>When reading your nand any Badblocks would have already been remapped to
the reserve area. This is important to keep in mind, specifically when
you encounter Badblocks where crucial data is kept such as blocks
0x001(Key Vault), 0xEF7(Config Block),.</p>
<h3 id="how-would-i-remap-the-badblocks-in-the-diagram-with-nandpro_1">How would I remap the BadBlocks in the diagram with nandpro?</h3>
<p>Assuming your attempting to flash the latest release of XBReboot named
as ‘xbr.bin’. And have made a full-backup and have already injected your
Key Vault and Configuration Blocks into ‘xbr.bin’. The commands would be
as follow:</p>
<p><code>nandpro xbr.bin: -r16 badblockF8.bin F8 8</code>
<code>nandpro xbr.bin: -w16 badblockF8.bin FF8 8</code></p>
<p>Is 8 correct? Yes remember nandpro reference blocks in sizes of 16 KB,
but 256/512 MB have a block size of 132 KB. 132/16 is equal to 8, that
why you need to use 8.</p>
<h3 id="if-using-xellous-to-flash-do-i-need-to-remap-badblocks_1">If using XeLLous to flash do I need to remap Badblocks?</h3>
<p>According to the XeLLous release notes no, it is suppose to be one of
the main features of the update. That is not to say bugs might not be
encountered. If you encounter suspicious issues, and believe it might be
related to a bad flash, then I recommend flashing manually with nandpro
or using trancy’s XBR-Flash for
Linux.</p>
<h3 id="i-have-a-badblock-between-blocks-0x000-and-0x050-and-cant-boot-into-xell-free60-version_1">I have a Badblock between blocks 0x000 and 0x050, and can’t boot into Xell (free60 version).</h3>
<p>First of all ensure your using the free60 version of Xell. Next you will
need to backup the location of the remapped BadBlocks like so (Remeber
your first Badblock always goes to 0xFF8, and each following Badblock
gets remapped to the spare):</p>
<p><code>nandpro lpt: -r256 backupFF8.bin FF8 8</code></p>
<p>Assuming your first Badblock was at 0x010 followed by seven more errors,
you will need to remap the free60 Xell data that was intended to be
stored in that block. Like this.</p>
<p><code>nandpro xell.bin: -r16 xell10.bin 10 8</code>
<code>nandpro lpt: -w16 xell10.bin FF8 8</code></p>
<p>Lastly the bad block needs to erased to prevent any corruption:</p>
<p><code>nandpro lpt: -e16 10 1</code></p>
<p>(EDIT: The bad block may not need to be erased. If the CRC in the ECC
data doesn't match that of the page, the SMC will deem it a bad block
anyway and then look to the spare area for a relocated
block.)</p>
<h3 id="i-have-a-badblock-between-blocks-0x000-and-0x050-and-cant-boot-into-xell-rgh-team-xecuter-dgx-version_1">I have a Badblock between blocks 0x000 and 0x050, and can’t boot into Xell (RGH / Team-Xecuter DGX version).</h3>
<p>XeLL for RGH/DGX is written with +w16 ('+' to signify the recreation of
ECC data) so you cannot simply -r16 from image_00000000.ecc (or
DGX.ecc) as it's not seen by NANDPro as a valid VNAND.</p>
<p>Therefore, the following steps must be carried out:</p>
<p>Assuming your first Badblock was at 0x010,</p>
<p>1. Make a copy of your original NAND</p>
<p><code>copy nanddump.bin tempnand.bin</code></p>
<p>2. Write the ECC to your NAND as per normal:</p>
<p><code>nandpro [LPT|USB]: +w16 image_00000000.ecc</code></p>
<p>At this point you should confirm that you get an 'error xxx writing to
xxx' message. This is perfectly normal.</p>
<p>3. Write the ECC to tempnand.bin using NANDPro:</p>
<p><code>nandpro tempnand.bin: +w16 image_00000000.ecc</code></p>
<p>4. Read block 0x010 from your newly written-to VNAND:</p>
<p><code>nandpro tempnand.bin: -r16 010.bin 10 8</code></p>
<p>5. Write the block to the same place in the spare area as the original
relocated bad block. If this is the first bad block, it should be 0x3FF
but check using 360 Flash Dump Tool, xNANDHealer, J-Runner etc to ensure
this is the case.</p>
<p><code>nandpro [LPT|USB]: -w16 010.bin FF8</code></p>
<p>Lastly the bad block needs to erased to prevent any corruption:</p>
<p><code>nandpro lpt: -e16 10 8</code></p>
<p>(EDIT: The bad block may not need to be erased. If the CRC in the ECC
data doesn't match that of the page, the SMC will deem it a bad block
anyway and then look to the spare area for a relocated block.)</p>
<p>--<a href="User:Xb0xGuru" title="wikilink">Xb0xGuru</a> 15:19, 24 February 2013 (UTC)</p>
<p>Source:
<a href="https://web.archive.org/web/20100713001647/https://docs.google.com/View?id=dnfmv5h_23gw47ddgs">google-docs</a> (archive.org mirror) &amp;
<a href="http://www.xboxhacker.org/index.php?topic=13618.0">XBH, posted by trancy</a></p>
<p><a href="../Category_Xbox360_Hardware">Category:Xbox360_Hardware</a>
<a href="../Category_Xbox360_System_Software">Category:Xbox360 System Software</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
